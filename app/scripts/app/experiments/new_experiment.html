<div ng-if="!loaded">
  <div class="row">
    <div class="col-sm-6 col-sm-offset-3">
      <div class="panel">
        <div class="panel-heading">
          <h3>Please wait</h3>
        </div>
        <div class="panel-body">
          We are loading the data corresponding to your model.
        </div>
      </div>
    </div>
  </div>
</div>
<div ng-cloak ng-if="loaded">

  <div class="row">
    <div class="col-xs-12">
      <div class="panel">
        <div class="panel-heading">
          <h3 ng-if="model">
            Run an Experiment on
            <a ui-sref="models-edit({slug: model.slug, isCopy: false})" ng-bind="model.title"></a>
            <other-experiments model_slug="model.slug"></other-experiments>
          </h3>
          <h3 ng-if="!model">
            Run an Experiment on &lt;Unsaved Model&gt;
            <button class="btn btn-primary col-bottom" ng-click="save_model()">Save Model</button>
          </h3>
        </div>
      </div>

      <div class="row">

        <div class="col-sm-3">
          <div class="panel">
            <div class="panel-heading">
              Choose a ML Algorithm
            </div>
            <div class="panel-body">

              <div ng-if="!ml_methods.length">
              <h4>Note:</h4>
                <p>
                  No algorithm available for the moment...
                </p>
              </div>

              <accordion ng-if="ml_methods.length" close-others="false">
                <accordion-group heading="Statistical Analysis" ng-init="acc_stats.open = true" is-open="acc_stats.open" ng-click="!acc_stats.open">
                  <p ng-repeat="method in ml_methods | filter:{type:'statistics'}  | orderBy:'-label'">
                    <label class="btn btn-primary-alt col-xs-12"
                           ng-model="shared.chosen_method"
                           ng-disabled="method.disable"
                           ng-click="method.disable? angular.noop : shared.method_parameters = []"
                           btn-radio="method"
                           uncheckable
                           ng-bind="method.label"></label>
                    <br><br>
                  </p>
                </accordion-group>
                <accordion-group heading="Features Extraction" ng-init="acc_fe.open = true" is-open="acc_fe.open" ng-click="!acc_fe.open">
                  <p ng-repeat="method in ml_methods | filter:{type:'features_extraction'}  | orderBy:'-label'">
                    <label class="btn btn-primary-alt col-xs-12"
                           ng-model="shared.chosen_method"
                           ng-disabled="method.disable"
                           ng-click="method.disable? angular.noop : shared.method_parameters = []"
                           btn-radio="method"
                           uncheckable
                           ng-bind="method.label"></label>
                    <br><br>
                  </p>
                </accordion-group>
                <accordion-group heading="Predictive Model" ng-init="acc_pm.open = true" is-open="acc_pm.open" ng-click="!acc_pm.open">
                  <p ng-repeat="method in ml_methods | filter:{type:'predictive_model'}  | orderBy:'-label'">
                    <label class="btn btn-primary-alt col-xs-12"
                           ng-model="shared.chosen_method"
                           ng-disabled="!method.available"
                           ng-click="method.available? shared.method_parameters = [] : angular.noop"
                           btn-radio="method"
                           uncheckable
                           ng-bind="method.label"></label>
                    <br><br>
                  </p>
                </accordion-group>
              </accordion>
            </div>
          </div>
        </div>

        <div class="col-sm-6">

          <!-- ng-show instead of ng-if because I don't want the inner directives to be destroyed  when unpicking the method -->
          <form class="row" ng-show="shared.chosen_method">

            <div class="col-xs-12">

              <accordion close-others="false">

                <accordion-group is-open="true">
                  <accordion-heading>
                    <span class="ti ti-panel"></span>
                    Configure The Algorithm's Parameters
                  </accordion-heading>

                  <div ng-if="shared.chosen_method.parameters.length" class="form-group">
                    <div ng-repeat="parameter in shared.chosen_method.parameters" class="form-inline">
                      <label for="{{parameter.name}}">
                        <b ng-bind="parameter.label + ': '"></b>
                      </label>
                      <input type="number"
                             step="1"
                             id="{{parameter.name}}"
                             class="form-control"
                             ng-model="shared.method_parameters[$index].value"
                             value="{{shared.method_parameters[$index].value}}"
                             ng-init="shared.method_parameters[$index] = {code: parameter.code, label: parameter.label, value: parseInt(parameter.default_value)}">
                      <p ng-bind="parameter.description"></p>
                    </div>
                  </div>
                  <div ng-if="!shared.chosen_method.parameters.length">
                    There are no parameters for <span ng-bind="shared.chosen_method.label"></span>.
                  </div>

                  <button class="btn btn-primary pull-right"
                          ng-class="{'disabled': method_already_configured() || configuration_not_valid()}"
                          ng-click="add_to_experiment()">
                    Add to experiment
                  </button>

                </accordion-group>

                <accordion-group is-open="help_is_open">
                  <accordion-heading>
                    <span class="ti ti-help-alt"></span>
                    Help
                  </accordion-heading>

                  <div ng-if="!shared.chosen_method.help">
                    There is no help for this algorithm
                  </div>
                  <div ng-if="shared.chosen_method.help" btf-markdown="shared.chosen_method.help"></div>
                </accordion-group>
              </accordion>
            </div>
          </form>


          <div class="row" ng-if="!shared.chosen_method">

            <div class="col-xs-12">
              <div class="panel">
                <div class="panel-heading">
                  About Running Experiments
                </div>
                <div class="panel-body">
                  Explanation about running experiments
                </div>
              </div>
            </div>

          </div>

        </div>

        <div class="col-xs-3">
          <algorithm-runner></algorithm-runner>
        </div>

      </div>

    </div>

  </div>

</div>
