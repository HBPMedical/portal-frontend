:3000 {

	encode gzip zstd

	log {
		level {$ERROR_LOG_LEVEL:warn}
	}

	handle /* {
		root * /usr/share/caddy/html
		try_files {path} /index.html
		file_server
	}

	handle_path /services/* {
		reverse_proxy {$GATEWAY_SERVER} {
			header_up Host {host}
			header_up X-Real-IP {remote_host}
			header_up X-Forwarded-For {remote_host}
			header_up X-Forwarded-Proto {$EXTERNAL_MIP_PROTOCOL:https}
		}
	}

	handle_errors {
		@4xx expression `{http.error.status_code} == 401 || {http.error.status_code} == 404`
		redir * / temporary
	}
}
