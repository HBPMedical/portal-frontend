<div ng-if="loading">
  <div class="row">
    <div class="col-sm-6 col-sm-offset-3">
      <div class="panel">
        <div class="panel-heading">
          <h3>
            Please wait
            <other-experiments model-slug="model_slug"></other-experiments>
          </h3>
        </div>
        <div class="panel-body">
          We are loading the data corresponding to your experiment.
        </div>
      </div>
    </div>
  </div>
</div>

<div ng-cloak ng-if="!loading">

  <div class="row">
    <div class="col-xs-12">
      <div class="panel">
        <div class="panel-heading">
          <h3>
            Results of Experiment
            <b ng-bind="experiment.name"></b>
            on <a ui-sref="models-edit({slug: experiment.model.slug, isCopy: false})" ng-bind="experiment.model.title"></a>
            <other-experiments model-slug="model_slug"></other-experiments>
            <button class="btn btn-primary pull-right"
                    ng-cloak
                    style="margin: 1px 5px"
                    ng-class="{'disabled': sharing_working }"
                    ng-click="experiment.shared ? mark_experiment_as_unshared() : mark_experiment_as_shared()">
              <span ng-class="{'fa fa-spin fa-spinner': sharing_working}"></span>
              <span ng-bind="experiment.shared ? 'Unshare experiment' : 'Share experiment'"></span>
            </button>
          </h3>
          <h5>Created {{ experiment.created | fromNow }} by {{ experiment.createdBy.fullname }}</h5>
        </div>
      </div>

      <div class="row">

        <div class="col-xs-3">
          <div class="panel">
            <div class="panel-body">
              <h3>Algorithms:</h3>
              <ul>
                <li ng-repeat="algorithm in experiment.algorithms track by $index">
                  <div style="max-width: calc(100% - 20px); display: inline-block; vertical-align: top">
                    <span ng-bind="algorithm.name"></span>
                  </div>
                </li>
              </ul>
              <h3 ng-if="experiment.validations.length">Validations:</h3>
              <ul>
                <li ng-repeat="validation in experiment.validations">
                  <span ng-bind="validation.code"></span>:
                  <span ng-bind="validation.parameters[0].value"></span>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="col-sm-9">

          <div class="panel" ng-if="!experiment.finished">
            <div class="panel-heading">
              <h3>
                <span class="fa fa-spinner fa-spin"></span>
                Your experiment is currently running.
              </h3>
            </div>
            <div class="panel-body">
              <p>
                Please check back in a few minutes. This page will automatically
                refresh once your experiment has finished executing.
              </p>
            </div>
          </div>
          <div class="panel" ng-if="experiment.finished && experiment.hasError">
            <div class="panel-heading">
              <h3>
                <span class="fa fa-warning" style="color: darkorange"></span>
                An error has occurred.
              </h3>
            </div>
            <div class="panel-body">
              An error has occurred while running your experiment
              <b ng-bind="experiment.name"></b>. Here's the message:
              <br><br>
              <pre ng-bind="experiment.result"></pre>
            </div>
          </div>
          <div class="experiment-details" ng-if="experiment.finished && !experiment.hasError" ng-cloak>
            <tabset active="0">

              <tab heading="Overview" ng-if="overview_charts.length">
                <div class="panel">
                  <div class="panel-body">
                    <div class="row">
                      <div class="single-legend col-sm-12"></div>
                    </div>
                    <div class="row overview-charts">
                      <div class="col-sm-3" ng-repeat="chart_config in overview_charts">
                        <highchart config="chart_config"></highchart>
                      </div>
                    </div>
                    <div class="pull-right">
                      <button class="btn btn-default" ng-click="hideJson = !hideJson" ng-init="hideJson=true">
                        <span ng-bind="hideJson ? 'Show' : 'Hide'"></span> raw JSON
                      </button>
                      <pre collapse="hideJson" ng-bind="experiment.raw"></pre>
                    </div>
                  </div>
                </div>
              </tab>
              <tab ng-repeat="method in experiment.display.methods" heading="{{ method.name }}">
                <div class="panel">
                  <div class="panel-body">
                    <h1>Results</h1>
                    <method-result data="method"></method-result>
                  </div>
                </div>
              </tab>
            </tabset>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
