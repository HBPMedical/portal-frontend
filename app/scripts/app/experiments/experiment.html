<div ng-if="!loaded">
  <div class="row">
    <div class="col-sm-6 col-sm-offset-3">
      <div class="panel">
        <div class="panel-heading">
          <h3>Please wait</h3>
        </div>
        <div class="panel-body">
          We are loading the data corresponding to your model.
        </div>
      </div>
    </div>
  </div>
</div>
<div ng-cloak ng-if="loaded">

  <div class="row">
    <div class="col-xs-9">
      <div class="panel">
        <div class="panel-heading">
          <h3 ng-if="model">Run an Experiment on <a ui-sref="models-edit({slug: model.slug, isCopy: false})" ng-bind="model.title"></a> </h3>
          <h3 ng-if="!model">
            Run an Experiment on &lt;Unsaved Model&gt;
            <button class="btn btn-primary col-bottom" ng-click="save_model()">Save Model</button>
          </h3>
        </div>
      </div>

      <div class="row">

        <div class="col-sm-4">
          <div class="panel">
            <div class="panel-heading">
              Choose a ML Algorithm
            </div>
            <div class="panel-body">

              <p>
              <h4>Note:</h4>
              We are only presenting <span ng-bind="predictor_type"></span>-type algorithms because
              the variable you are trying to predict, <span ng-bind="dataset.variable[0]"></span>
              has <span ng-bind="predicting_type"></span>-typed values.
              </p>

              <p ng-repeat="method in ml_methods_by_type[predictor_type]">
                <label class="btn btn-primary-alt col-xs-12"
                       ng-model="shared.chosen_method"
                       btn-radio="method"
                       uncheckable
                       ng-class="foo() ? 'disabled' : ''"
                       ng-bind="method.display"></label>
                <br><br>
              </p>
            </div>
          </div>
        </div>

        <div class="col-sm-8">

          <!-- ng-show instead of ng-if because I don't want the inner directives to be destroyed  when unpicking the method -->
          <form class="row" ng-show="shared.chosen_method">

            <div class="col-xs-12">

              <accordion close-others="false">

                <accordion-group is-open="false">
                  <accordion-heading>
                    <span class="ti ti-panel"></span>
                    Configure The Algorithm's Parameters
                  </accordion-heading>

                  <div ng-if="shared.chosen_method.parameters.length" class="form-group">
                    <div ng-repeat="parameter in shared.chosen_method.parameters" class="form-inline">
                      <label for="{{parameter.name}}">
                        <b ng-bind="parameter.display + ': '"></b>
                      </label>
                      <input type="number"
                             step="1"
                             id="{{parameter.name}}"
                             class="form-control"
                             ng-model="query.parameters[parameter.name]"
                             ng-init="query.parameters[parameter.name] = parameter.default_value">
                      <p ng-bind="parameter.description"></p>
                    </div>
                  </div>
                  <div ng-if="!shared.chosen_method.parameters.length">
                    There are no parameters for the <span ng-bind="shared.chosen_method.display"></span>.
                  </div>
                </accordion-group>

                <accordion-group is-open="true">
                  <accordion-heading>
                    <span class="ti ti-check-box"></span>
                    Run the algorithm / Results
                  </accordion-heading>

                  <algorithm-runner query="query" algorithm="shared.chosen_method.name"></algorithm-runner>

                </accordion-group>

                <accordion-group is-open="help_is_open">
                  <accordion-heading>
                    <span class="ti ti-help-alt"></span>
                    Help
                  </accordion-heading>

                  <div ng-if="!shared.chosen_method.help">
                    There is no help for this algorithm
                  </div>
                  <div ng-if="shared.chosen_method.help" btf-markdown="shared.chosen_method.help"></div>
                </accordion-group>
              </accordion>
            </div>
          </form>


          <div class="row" ng-if="!shared.chosen_method">

            <div class="col-xs-12">
              <div class="panel">
                <div class="panel-heading">
                  About Running Experiments
                </div>
                <div class="panel-body">
                  Explanation about running experiments
                </div>
              </div>
            </div>

          </div>

        </div>
      </div>

    </div>

    <div class="col-xs-3">
      <div class="panel">
        <div class="panel-heading">
          Running Experiments
        </div>
        <div class="panel-body">
          Coming soon
          <br>
          <br>

          <div>
            <a href="">Experiment #732 on MyModel3</a>
            <div class="progress">
              <div class="progress-bar progress-bar-striped active progress-bar-success" role="progressbar" style="width: 100%"></div>
            </div>
          </div>

          <div>
            <a href="">Experiment #735 on MyModel5</a>
            <div class="progress">
              <div class="progress-bar progress-bar-striped active progress-bar-success" role="progressbar" style="width: 100%">
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

</div>
